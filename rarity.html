<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>MegaPython — Rarity Checker</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #0a220a;
      color: #e2e8f0;
      overflow-x: hidden;
      background-image: 
        radial-gradient(circle at 20% 30%, rgba(34, 139, 34, 0.1) 0%, transparent 40%),
        radial-gradient(circle at 80% 70%, rgba(34, 139, 34, 0.1) 0%, transparent 40%),
        url("data:image/svg+xml,%3Csvg width='20' height='20' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%23225511' fill-opacity='0.1'%3E%3Cpath d='M0,0 L20,10 L0,20 Z' /%3E%3C/g%3E%3C/svg%3E");
    }
    
    .pixel-font {
      font-family: 'Press Start 2P', cursive;
    }
    
    .jungle-border {
      border: 4px solid #3a7d3a;
      box-shadow: 0 0 0 2px #1b3f1b, 0 0 0 6px #4a9e4a;
      background: #1e3e1e;
    }
    
    .pixel-card {
      background: #1e3e1e;
      border: 4px solid #4a9e4a;
      box-shadow: 0 0 0 2px #0f2a0f, 0 0 0 6px #4a9e4a, 0 0 15px rgba(74, 158, 74, 0.5);
      transition: all 0.3s ease;
    }
    
    .pixel-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 0 0 2px #0f2a0f, 0 0 0 6px #4a9e4a, 0 0 25px rgba(74, 158, 74, 0.8);
    }
    
    .glow {
      text-shadow: 0 0 10px rgba(74, 222, 128, 0.7);
    }
    
    .jungle-glow {
      text-shadow: 0 0 10px rgba(74, 158, 74, 0.7);
    }
    
    .pixel-button {
      background: #4a9e4a;
      color: #0f172a;
      border: 2px solid #0f172a;
      box-shadow: 0 4px 0 #0f172a;
      transition: all 0.1s ease;
    }
    
    .pixel-button:hover {
      transform: translateY(2px);
      box-shadow: 0 2px 0 #0f172a;
    }
    
    .quote-box {
      background: #1e3e1e;
      border: 4px solid #4a9e4a;
      box-shadow: 0 0 0 2px #0f2a0f, 0 0 0 6px #4a9e4a;
      padding: 30px;
      margin: 20px 0;
      position: relative;
    }
    
    .quote-box::before {
      content: """;
      font-size: 60px;
      color: #4a9e4a;
      position: absolute;
      top: -10px;
      left: 10px;
      font-family: Arial;
    }
    
    .quote-box::after {
      content: """;
      font-size: 60px;
      color: #4a9e4a;
      position: absolute;
      bottom: -40px;
      right: 10px;
      font-family: Arial;
      transform: rotate(180deg);
    }
    
    .jungle-leaf {
      position: absolute;
      width: 40px;
      height: 40px;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 40 40'%3E%3Cpath fill='%234a9e4a' d='M20,5 C10,5 5,15 5,25 C5,35 15,35 20,35 C25,35 35,35 35,25 C35,15 30,5 20,5 Z'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      z-index: 0;
      opacity: 0.3;
    }
    
    .rarity-badge {
      display: inline-block;
      padding: 8px 20px;
      border-radius: 25px;
      font-size: 0.9rem;
      margin-top: 10px;
      font-weight: bold;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    
    .common { 
      background: #4a5568; 
      color: white; 
      box-shadow: 0 0 10px rgba(74, 85, 104, 0.5);
    }
    .uncommon { 
      background: #38a169; 
      color: white; 
      box-shadow: 0 0 10px rgba(56, 161, 105, 0.5);
    }
    .rare { 
      background: #3182ce; 
      color: white; 
      box-shadow: 0 0 10px rgba(49, 130, 206, 0.5);
    }
    .epic { 
      background: #805ad5; 
      color: white; 
      box-shadow: 0 0 10px rgba(128, 90, 213, 0.5);
    }
    .legendary { 
      background: #d69e2e; 
      color: black; 
      box-shadow: 0 0 10px rgba(214, 158, 46, 0.5);
    }
    .mythic { 
      background: #e53e3e; 
      color: white; 
      box-shadow: 0 0 10px rgba(229, 62, 62, 0.5);
    }
    
    .trait-card {
      background: rgba(42, 74, 42, 0.7);
      border-radius: 8px;
      padding: 15px;
      text-align: center;
      transition: all 0.3s ease;
    }
    
    .trait-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 5px 15px rgba(74, 158, 74, 0.3);
    }
    
    .nft-preview {
      width: 200px;
      height: 200px;
      border: 4px solid #4a9e4a;
      border-radius: 12px;
      box-shadow: 0 0 0 2px #0f2a0f, 0 0 0 6px #4a9e4a;
      margin: 0 auto;
      overflow: hidden;
    }
    
    .nft-preview img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
  </style>
</head>
<body class="min-h-screen">
  <!-- Jungle leaves decoration -->
  <div class="jungle-leaf" style="top: 10%; left: 5%;"></div>
  <div class="jungle-leaf" style="top: 15%; right: 7%; transform: rotate(45deg);"></div>
  <div class="jungle-leaf" style="top: 40%; left: 8%; transform: rotate(80deg);"></div>
  <div class="jungle-leaf" style="bottom: 20%; right: 10%; transform: rotate(120deg);"></div>
  <div class="jungle-leaf" style="bottom: 30%; left: 12%; transform: rotate(160deg);"></div>

  <div class="relative z-10 max-w-4xl mx-auto p-6">
    <header class="text-center mb-8">
      <h1 class="text-4xl pixel-font text-green-500 mb-4 jungle-glow">MegaPython Rarity Checker</h1>
      <p class="text-lg text-gray-400 mb-6">Enter a token ID (1–2222) to discover your Python's rarity and unique quote!</p>
    </header>

    <div class="flex gap-2 justify-center mb-8">
      <input id="tokenId" type="number" min="1" max="2222" placeholder="Token ID (e.g. 42)" class="px-4 py-3 rounded-lg bg-slate-800 border border-slate-700 focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-500/30 w-48" />
      <button id="btnCheck" class="px-6 py-3 bg-emerald-500 hover:bg-emerald-400 text-black rounded-lg font-bold transition-colors">Check Rarity</button>
    </div>

    <div id="result" class="pixel-card p-6 space-y-6 hidden">
      <div id="preview" class="text-center"></div>
      <div id="traits" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3"></div>
      <div id="rarityScore" class="text-center p-3 bg-slate-900/50 rounded-lg"></div>
    </div>

    <div class="mt-10 text-center text-sm text-gray-500">
      <p>For automatic rarity ranking, upload <code class="px-2 py-1 bg-slate-800 rounded">rarityData.json</code> to the repo root.</p>
      <p class="mt-6"><a href="/" class="text-emerald-400 hover:text-emerald-300 underline transition-colors">← Back to Home</a></p>
    </div>
  </div>

<script>
// Array of rarity quotes
const RARITY_QUOTES = {
  common: [
    "Just another pixel in the jungle.",
    "Common, but still crawling through MegaETH vines.",
    "Even the smallest snakes leave tracks in the mud.",
    "MegaPython says: not rare, but still wild.",
    "The jungle is full of commons… blend in or stand out?"
  ],
  uncommon: [
    "Rare scales shimmer under the pixel sun.",
    "You found a python that doesn't hiss often.",
    "In the MegaETH jungle, rare is the new normal.",
    "Rare pixels bite harder than you think.",
    "This rarity slithers quietly but strikes fast."
  ],
  rare: [
    "Super rare! The jungle whispers your name.",
    "Not every explorer survives this deep into the vines.",
    "Pixels sharpen into fangs at this level.",
    "The python coils tighter — you're holding power.",
    "Super rare… jungle legends are written about these."
  ],
  epic: [
    "Epic! This Python has legends whispered about it in the digital jungle!",
    "An epic Python with scales that shimmer with blockchain energy!",
    "This Python has explored the deepest parts of the MegaETH jungle! Epic adventures.",
    "Epic patterns emerge on this Python's scales! A special find in the jungle.",
    "This Python has consumed epic digital berries from the MegaETH forest!"
  ],
  legendary: [
    "Legendary! Only a few dare to hunt this beast.",
    "The MegaPython king emerges from the digital canopy.",
    "Your pixels glow with untold jungle energy.",
    "The rarest serpent — worshipped in the MegaETH temples.",
    "You found the legend… now the legend finds you."
  ],
  mythic: [
    "MYTHIC! This Python is said to have been coded by the blockchain gods themselves!",
    "A mythic Python from the earliest days of the Reptiles Universe!",
    "This Python's patterns contain secret messages from the creators of MegaETH!",
    "BEYOND MYTHIC! This Python transcends rarity categories! A once-in-a-lifetime find!",
    "Mythic scales that shimmer with the essence of the blockchain itself!"
  ]
};

// Use Rarible API for metadata
const RARIBLE_API_BASE = 'https://api.rarible.org/v0.1';
const MEGAPYTHON_CONTRACT = '0xf4c6cc08f7bba6867119f2e8f9556961a76f7098';

const btn = document.getElementById('btnCheck');
const tokenInput = document.getElementById('tokenId');
const preview = document.getElementById('preview');
const traitsEl = document.getElementById('traits');
const rarityEl = document.getElementById('rarityScore');
const resultEl = document.getElementById('result');

async function fetchJSON(url) {
  try {
    const response = await fetch(url);
    if (!response.ok) throw new Error(`HTTP ${response.status}`);
    return await response.json();
  } catch (error) {
    console.error('Failed to fetch JSON:', error);
    return null;
  }
}

async function loadRarityData() {
  const url = "./rarityData.json";
  try {
    const data = await fetchJSON(url);
    return data;
  } catch (e) {
    return null;
  }
}

function showError(msg) {
  preview.innerHTML = `<div class="p-4 bg-red-900/30 border border-red-700/50 rounded-lg text-red-300">${msg}</div>`;
  traitsEl.innerHTML = "";
  rarityEl.textContent = "";
  resultEl.classList.remove('hidden');
}

function getRarityCategory(score) {
  if (score >= 90) return "mythic";
  if (score >= 75) return "legendary";
  if (score >= 60) return "epic";
  if (score >= 40) return "rare";
  if (score >= 20) return "uncommon";
  return "common";
}

function getRarityQuote(category) {
  const quotes = RARITY_QUOTES[category];
  return quotes[Math.floor(Math.random() * quotes.length)];
}

function showMetadata(meta, rarityData) {
  preview.innerHTML = "";
  
  // Create image preview using Rarible API
  const imageUrl = meta.meta?.content?.[0]?.url || '/placeholder-nft.png';
  const previewHtml = `
    <div class="nft-preview mb-4">
      <img src="${imageUrl}" alt="${meta.meta.name}" onerror="this.src='/placeholder-nft.png'">
    </div>
    <div class="text-2xl font-bold mb-2 text-emerald-300 pixel-font">${meta.meta.name || `MegaPython #${tokenInput.value}`}</div>
  `;
  preview.innerHTML = previewHtml;

  // Calculate rarity score
  let score = 0;
  const attrs = meta.meta?.attributes || [];
  
  if (rarityData) {
    for (const a of attrs) {
      const t = a.key;
      const v = a.value;
      
      if (rarityData.attributes && rarityData.attributes[t] && rarityData.attributes[t][v]) {
        const count = rarityData.attributes[t][v];
        score += 1 / (count / (rarityData.totalSupply || 1));
      }
    }
  } else {
    // Fallback scoring if no rarity data
    score = Math.min(100, Math.max(0, attrs.length * 15 + Math.random() * 20));
  }
  
  // Get rarity category and quote
  const category = getRarityCategory(score);
  const quote = getRarityQuote(category);
  
  // Display quote
  const quoteBox = document.createElement('div');
  quoteBox.className = 'quote-box text-center';
  quoteBox.innerHTML = `
    <p class="text-lg italic text-green-200 mb-4">${quote}</p>
    <div class="rarity-badge ${category} pixel-font">${category.toUpperCase()}</div>
  `;
  preview.appendChild(quoteBox);

  // Display traits
  traitsEl.innerHTML = "";
  
  if (attrs.length === 0) {
    traitsEl.innerHTML = '<div class="col-span-3 text-gray-400 text-center p-4 bg-slate-900/50 rounded-lg">No attributes found in metadata.</div>';
  } else {
    attrs.forEach(a => {
      const traitCard = document.createElement('div');
      traitCard.className = 'trait-card';
      traitCard.innerHTML = `
        <div class="font-semibold text-emerald-300 mb-1 pixel-font" style="font-size: 0.7rem;">${a.key || 'Trait'}</div>
        <div class="text-lg font-medium">${a.value}</div>
      `;
      traitsEl.appendChild(traitCard);
    });
  }
  
  // Display score
  if (rarityData) {
    rarityEl.innerHTML = `
      <div class="inline-flex items-center bg-slate-900 px-4 py-2 rounded-full border border-emerald-500/30">
        <span class="text-emerald-400 font-bold mr-2">Rarity Score:</span> 
        <span class="text-white">${score.toFixed(3)}</span>
      </div>
      <p class="text-gray-400 mt-2 text-sm">Based on uploaded rarityData.json (higher = rarer)</p>
    `;
  } else {
    rarityEl.innerHTML = `
      <div class="text-gray-400 italic">
        Rarity ranking not available. Upload rarityData.json to enable automatic rarity scoring.
      </div>
    `;
  }
}

btn.addEventListener('click', async () => {
  const id = tokenInput.value.trim();
  if (!id || isNaN(id) || Number(id) < 1 || Number(id) > 2222) { 
    showError('Please enter a valid token ID between 1 and 2222'); 
    return; 
  }
  
  const idn = Number(id);
  preview.innerHTML = '<div class="text-center py-8"><div class="inline-block animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-emerald-500"></div><p class="mt-3 text-gray-400">Loading metadata...</p></div>';
  traitsEl.innerHTML = '';
  rarityEl.textContent = '';
  resultEl.classList.remove('hidden');

  try {
    // Use Rarible API to fetch metadata
    const metaUrl = `${RARIBLE_API_BASE}/items/ETHEREUM:${MEGAPYTHON_CONTRACT}:${idn}`;
    let meta = await fetchJSON(metaUrl);
    
    if (!meta) {
      showError('Metadata not found for this token ID.');
      return;
    }
    
    // Load rarity data if available
    const rarityData = await loadRarityData();
    
    showMetadata(meta, rarityData);
  } catch (error) {
    console.error('Error:', error);
    showError('An error occurred while fetching data. Please try again.');
  }
});

// Allow pressing Enter to submit
tokenInput.addEventListener('keypress', function(e) {
  if (e.key === 'Enter') {
    btn.click();
  }
});
</script>
</body>
</html>
